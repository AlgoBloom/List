"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@walletconnect/client"),t=require("@json-rpc-tools/utils/dist/cjs/format"),n=require("react"),a=require("react-dom"),o=require("react-qr-code"),l=require("algosdk");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=r(e),i=r(n),d=r(a),s=r(o),u=r(l);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function m(e,t,n,a){return new(n||(n=Promise))((function(o,l){function r(e){try{i(a.next(e))}catch(e){l(e)}}function c(e){try{i(a.throw(e))}catch(e){l(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}i((a=a.apply(e,t||[])).next())}))}class p extends Error{constructor(e,t,...n){super(...n),Error.captureStackTrace&&Error.captureStackTrace(this,p),this.name="PeraWalletConnectError",this.data=e,this.message=t}}var f="data:image/svg+xml,%3csvg width='13' height='12' viewBox='0 0 13 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3cg clip-path='url(%23clip0_6246_67262)'%3e%3crect x='0.0898438' y='1.42188' width='2' height='14.957' transform='rotate(-45 0.0898438 1.42188)' fill='black'/%3e%3crect width='2' height='14.957' transform='matrix(-0.707107 -0.707107 -0.707107 0.707107 12.082 1.42188)' fill='black'/%3e%3c/g%3e%3cdefs%3e%3cclipPath id='clip0_6246_67262'%3e%3crect width='12' height='12' fill='white' transform='translate(0.0820312)'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e";function g(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&a.firstChild?a.insertBefore(o,a.firstChild):a.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}g('.pera-wallet-connect-modal {\n  --pera-wallet-connect-modal-font-family: ui-rounded, "SF Pro Rounded", "SF Pro Text",\n    medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, ui-sans-serif,\n    "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",\n    sans-serif;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: fixed;\n  top: 0;\n  right: 0;\n  left: 0;\n  bottom: 0;\n  width: 100vw;\n  height: 100vh;\n  background-color: rgba(0, 0, 0, 0.3);\n  font-family: var(--pera-wallet-connect-modal-font-family);\n}\n.pera-wallet-connect-modal * {\n  box-sizing: border-box;\n}\n\n.pera-wallet-connect-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: auto;\n  height: 35px;\n  padding: 14px;\n  border: none;\n  border-radius: var(--small-radius-size);\n  outline: none;\n  cursor: pointer;\n  font-family: var(--pera-wallet-connect-modal-font-family);\n  font-size: 14px;\n}\n\n.pera-wallet-connect-modal__logo img {\n  display: block;\n  width: 32px;\n}\n\n.pera-wallet-connect-modal__close-button {\n  width: 30px;\n  height: 30px;\n  margin: 0;\n  padding: 0;\n  box-shadow: 1px 2px 2px rgba(0, 0, 0, 0.08);\n  background-color: white;\n  border-radius: 100%;\n}\n\n.pera-wallet-connect-modal__body {\n  position: relative;\n  width: 440px;\n  max-width: calc(100vw - 80px);\n  padding: 24px;\n  background-color: white;\n  box-shadow: 1px 2px 2px rgba(0, 0, 0, 0.08);\n  border-radius: 4px;\n}\n\n.pera-wallet-connect-modal__body__header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  position: absolute;\n  top: -40px;\n  right: 0;\n  left: 0;\n}');g(".pera-wallet-connect-modal__display-qr-code-button,\n.pera-wallet-connect-modal__launch-pera-wallet-button {\n  letter-spacing: -0.3px;\n}\n\n.pera-wallet-connect-modal__launch-pera-wallet-button {\n  display: block;\n  padding: 14px;\n  margin-bottom: 20px;\n  border-radius: 4px;\n  background-color: var(--pera-wallet-main-color);\n  color: black;\n  text-decoration: none;\n  text-align: center;\n  font-size: 14px;\n}\n\n.pera-wallet-connect-modal__cancel-button,\n.pera-wallet-connect-modal__display-qr-code-button {\n  width: 100%;\n  padding: 14px;\n  margin: 0;\n  background-color: white;\n  border: 1px solid black;\n  border-radius: 4px;\n  color: black;\n}\n\n.pera-wallet-connect-modal__qr-code {\n  cursor: none;\n  text-align: center;\n}\n\n.pera-wallet-connect-modal__qr-code__text {\n  margin-bottom: 15px;\n}\n\n.pera-wallet-connect-modal__pending-message {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n  height: 150px;\n  text-align: center;\n}\n\n.pera-wallet-connect-modal__pending-message__logo img {\n  width: 40px;\n}\n\n.pera-wallet-connect-modal__pending-message__text {\n  margin-top: 25px;\n}\n\n.pera-wallet-connect-modal__cancel-button {\n  margin-top: 20px;\n  border-color: rgba(0, 0, 0, 0.08);\n  color: rgba(0, 0, 0, 0.8);\n  font-size: 12px;\n}");function w(){return document.documentElement.clientWidth>=935}function h(){return/Android/i.test(navigator.userAgent)}function _(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)}const b=h()?"algorand://":"algorand-wc://",v="PeraWallet.Wallet",x="PeraWallet.BridgeURL",y="walletconnect",C="PeraWallet.DeepLink",E="PeraWallet.AppMeta";function S(){return localStorage.getItem(C)||b}function k(){const e=localStorage.getItem(E);return e?JSON.parse(e):{logo:"data:image/svg+xml,%3csvg width='32' height='32' viewBox='0 0 32 32' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='32' height='32' rx='6.4' fill='%23FFEE55'/%3e%3cpath d='M17.3877 7.90031C17.884 9.95672 17.7162 11.7656 17.0129 11.9406C16.3096 12.1155 15.3371 10.5903 14.8408 8.53392C14.3445 6.47751 14.5122 4.66862 15.2155 4.49365C15.9188 4.31868 16.8913 5.84389 17.3877 7.90031Z' fill='black'/%3e%3cpath d='M25.5835 9.66832C24.4843 8.50334 22.2974 8.8191 20.699 10.3736C19.1006 11.9281 18.6959 14.1327 19.7951 15.2977C20.8943 16.4627 23.0811 16.1469 24.6795 14.5924C26.278 13.0379 26.6827 10.8333 25.5835 9.66832Z' fill='black'/%3e%3cpath d='M16.8411 27.5071C17.5444 27.3321 17.6875 25.4209 17.1607 23.2383C16.6339 21.0556 15.6367 19.4281 14.9334 19.6031C14.23 19.778 14.087 21.6892 14.6138 23.8719C15.1406 26.0545 16.1378 27.6821 16.8411 27.5071Z' fill='black'/%3e%3cpath d='M9.67161 10.7349C11.7007 11.3333 13.1833 12.383 12.9832 13.0796C12.7831 13.7761 10.976 13.8557 8.94689 13.2574C6.91781 12.659 5.43516 11.6093 5.63528 10.9127C5.83541 10.2161 7.64253 10.1365 9.67161 10.7349Z' fill='black'/%3e%3cpath d='M22.8412 18.6005C24.9948 19.2356 26.5784 20.3151 26.3783 21.0117C26.1782 21.7082 24.2701 21.7581 22.1164 21.123C19.9628 20.4879 18.3792 19.4083 18.5793 18.7118C18.7794 18.0152 20.6875 17.9654 22.8412 18.6005Z' fill='black'/%3e%3cpath d='M11.9548 17.139C11.4516 16.6174 9.80117 17.3765 8.26843 18.8346C6.7357 20.2926 5.90108 21.8974 6.40426 22.419C6.90743 22.9406 8.55787 22.1815 10.0906 20.7234C11.6233 19.2654 12.458 17.6606 11.9548 17.139Z' fill='black'/%3e%3c/svg%3e",name:"Pera Wallet",main_color:"#ffee55"}}function N(e){let t=S();/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!t.includes("-wc")&&(t=t.replace("://","-wc://"));let n=`${t}wc?uri=${encodeURIComponent(e)}`;const a=function(){const{userAgent:e}=navigator;let t;return t=e.match(/chrome|chromium|crios/i)?"chrome":e.match(/firefox|fxios/i)?"firefox":e.match(/safari/i)?"safari":e.match(/opr\//i)?"opera":e.match(/edg/i)?"edge":void 0,navigator.brave&&(t="brave"),t}();return h()&&(n=e),a&&(n=`${n}&browser=${a}`),n}function P({uri:e,onClose:t}){const{logo:a,name:o,main_color:l}=k(),[r,c]=n.useState(!_()),[d,u]=n.useState(!1);return i.default.createElement("div",{className:"pera-wallet-connect-modal",style:{"--pera-wallet-main-color":l}},i.default.createElement("div",{className:"pera-wallet-connect-modal__body"},i.default.createElement("div",{className:"pera-wallet-connect-modal__body__header"},i.default.createElement("div",{className:"pera-wallet-connect-modal__logo"},i.default.createElement("img",{src:a})),i.default.createElement("button",{className:"pera-wallet-connect-button pera-wallet-connect-modal__close-button",onClick:t},i.default.createElement("img",{src:f}))),d?i.default.createElement("div",{className:"pera-wallet-connect-modal__pending-message"},i.default.createElement("div",{className:"pera-wallet-connect-modal__pending-message__logo"},i.default.createElement("img",{src:a})),i.default.createElement("div",{className:"pera-wallet-connect-modal__pending-message__text"},`Please wait while we connect you to ${o}...`)):i.default.createElement(i.default.Fragment,null,_()&&i.default.createElement("a",{onClick:m,className:"pera-wallet-connect-modal__launch-pera-wallet-button",href:N(e),rel:"noopener noreferrer",target:"_blank"},`Launch ${o}`),r&&i.default.createElement("div",{className:"pera-wallet-connect-modal__qr-code"},i.default.createElement("p",{className:"pera-wallet-connect-modal__qr-code__text"},`Scan QR code with ${o}`),i.default.createElement(s.default,{size:w()?392:240,value:e})),!r&&i.default.createElement("button",{className:"pera-wallet-connect-button pera-wallet-connect-modal__display-qr-code-button",onClick:p},"Display QR Code")),d&&i.default.createElement("button",{className:"pera-wallet-connect-button pera-wallet-connect-modal__cancel-button",onClick:function(){t()}},"Cancel")));function m(){u(!d)}function p(){c(!r)}}function I({onClose:e}){const{logo:t,name:a,main_color:o}=k();return n.useEffect((()=>{const t=window.open(S());t&&t.addEventListener("load",e)}),[]),i.default.createElement("div",{className:"pera-wallet-connect-modal",style:{"--pera-wallet-main-color":o}},i.default.createElement("div",{className:"pera-wallet-connect-modal__body"},i.default.createElement("div",{className:"pera-wallet-connect-modal__body__header"},i.default.createElement("div",{className:"pera-wallet-connect-modal__logo"},i.default.createElement("img",{src:t})),i.default.createElement("button",{className:"pera-wallet-connect-button pera-wallet-connect-modal__close-button",onClick:e},i.default.createElement("img",{src:f}))),i.default.createElement("a",{onClick:function(){e()},className:"pera-wallet-redirect-modal__launch-pera-wallet-button",href:S(),rel:"noopener noreferrer",target:"_blank"},`Launch ${a}`)))}g(".pera-wallet-redirect-modal__launch-pera-wallet-button {\n  display: block;\n  padding: 14px;\n  border-radius: 4px;\n  background-color: var(--pera-wallet-main-color);\n  color: black;\n  text-decoration: none;\n  text-align: center;\n  font-size: 14px;\n}");function q(e){const t=document.createElement("div");return t.setAttribute("id",e),document.body.appendChild(t),t}function A(e){const t=document.getElementById(e);t&&t.remove()}function T(){return function(e,t={}){return fetch(e,t).then((e=>e.json())).then((e=>e))}("https://wc.perawallet.app/servers.json")}function M(){return m(this,void 0,void 0,(function*(){const e=localStorage.getItem(x);if(e)return e;const t=function(e){const t=e.slice();for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}((yield T()).servers)[0];return localStorage.setItem(x,t),t}))}function O(e){return Uint8Array.from(window.atob(e),(e=>e.charCodeAt(0)))}const B={open:function(e,t){const n=q("pera-wallet-connect-modal-wrapper");d.default.render(i.default.createElement(P,{onClose:function(){A("pera-wallet-connect-modal-wrapper"),t()},uri:e}),n)},close:()=>A("pera-wallet-connect-modal-wrapper")};window.global=window,window.Buffer=window.Buffer||require("buffer").Buffer,exports.PeraWalletConnect=class{constructor(e){this.bridge=(null==e?void 0:e.bridge)||localStorage.getItem(x)||"",(null==e?void 0:e.deep_link)&&localStorage.setItem(C,e.deep_link),(null==e?void 0:e.app_meta)&&localStorage.setItem(E,JSON.stringify(e.app_meta)),this.connector=null}connect(){return new Promise(((e,t)=>m(this,void 0,void 0,(function*(){var n;try{(null===(n=this.connector)||void 0===n?void 0:n.connected)&&(yield this.connector.killSession());let a="";this.bridge||(a=yield M()),this.connector=new c.default({bridge:this.bridge||a,qrcodeModal:B}),yield this.connector.createSession({chainId:4160}),this.connector.on("connect",((n,a)=>{var o,l,r;n&&t(n),e((null===(o=this.connector)||void 0===o?void 0:o.accounts)||[]),r=(null===(l=this.connector)||void 0===l?void 0:l.accounts)||[],localStorage.setItem(v,JSON.stringify({type:"pera-wallet",accounts:r,selectedAccount:r[0]}))}))}catch(e){console.log(e);const{name:n}=k();t(new p({type:"SESSION_CONNECT",detail:e},e.message||`There was an error while connecting to ${n}`))}}))))}reconnectSession(){var e;return m(this,void 0,void 0,(function*(){try{if(this.connector)return this.connector.accounts||[];if((yield T()).servers.includes(this.bridge))return this.connector=new c.default({bridge:this.bridge,qrcodeModal:B}),(null===(e=this.connector)||void 0===e?void 0:e.accounts)||[];throw new p({type:"SESSION_RECONNECT",detail:""},"The bridge server is not active anymore. Disconnecting.")}catch(e){this.disconnect();const{name:t}=k();throw new p({type:"SESSION_RECONNECT",detail:e},e.message||`There was an error while reconnecting to ${t}`)}}))}disconnect(){var e;const t=null===(e=this.connector)||void 0===e?void 0:e.killSession();return null==t||t.then((()=>{this.connector=null})),localStorage.removeItem(y),localStorage.removeItem(v),localStorage.removeItem(x),t}signTransaction(e,n){if(!this.connector)throw new Error("PeraWalletConnect was not initialized correctly.");const a=e.flatMap((e=>e.map((e=>{let t;n&&!(e.signers||[]).includes(n)&&(t=[]);const a={txn:(o=e.txn,Buffer.from(u.default.encodeUnsignedTransaction(o)).toString("base64"))};var o;return Array.isArray(t)&&(a.signers=t),a})))),o=t.formatJsonRpcRequest("algo_signTxn",[a]);return _()&&function(){const e=q("pera-wallet-redirect-modal-wrapper");d.default.render(i.default.createElement(I,{onClose:function(){A("pera-wallet-redirect-modal-wrapper")}}),e)}(),this.connector.sendCustomRequest(o).then((e=>{const t=e.filter(Boolean);return"string"==typeof t[0]?t.map(O):t.map((e=>Uint8Array.from(e)))})).catch((e=>Promise.reject(new p({type:"SIGN_TRANSACTIONS",detail:e},e.message||"Failed to sign transaction")))).finally((()=>A("pera-wallet-redirect-modal-wrapper")))}};
